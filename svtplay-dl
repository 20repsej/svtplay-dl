#!/usr/bin/env python
import re,urllib2,urllib,sys,os,subprocess
def getdata(url):
	request = urllib2.Request(url)
	request.add_header = [('User-Agent', 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.0.3) Gecko/2008092417 Firefox/3.0.3')]
	response = urllib2.urlopen(request)
	data = response.read()
	response.close();
	return data

argv = sys.argv[1]
text = getdata(argv)
m = re.search('dynamicStreams=(.*)\&amp\;background', text)
if m:
	new = m.group(1)
	tmp = new.split("|")
	m = re.search('url:(.*)\,',tmp[0])
else:
	m = re.search('pathflv=(.*)\&amp\;background',text)
	if not m:
		print "Err: cant find stream"
		sys.exit(2)
stream = m.group(1)
output = os.path.basename(stream)
command = ["/usr/bin/rtmpdump","-r",stream,"-o",output]
subprocess.call(command)
